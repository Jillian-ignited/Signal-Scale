<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signal & Scale - Brand Intelligence Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { background-color: #fef3c7; color: #92400e; }
        .progress-bar { transition: width 0.3s ease; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .setup-form { display: block; }
        .dashboard { display: none; }
        .setup-form.hidden { display: none; }
        .dashboard.active { display: block; }
    </style>
</head>
<body class="bg-stone-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-stone-200 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-stone-900 rounded-lg flex items-center justify-center">
                    <i data-lucide="target" class="w-5 h-5 text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-semibold text-stone-900">Signal & Scale</h1>
                    <p class="text-sm text-stone-600">Brand Intelligence Platform</p>
                </div>
            </div>
            <div class="flex items-center space-x-3">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-amber-50 text-amber-700 border border-amber-200">
                    <i data-lucide="crown" class="w-3 h-3 mr-1"></i>
                    Professional Plan
                </span>
                <button id="newAnalysis" class="inline-flex items-center px-4 py-2 border border-stone-300 text-stone-700 hover:bg-stone-50 text-sm font-medium rounded-md dashboard">
                    <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                    New Analysis
                </button>
                <button id="runAnalysis" class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-md dashboard">
                    <i data-lucide="play" class="w-4 h-4 mr-2"></i>
                    <span id="analysisText">Run Analysis</span>
                </button>
                <button class="inline-flex items-center px-4 py-2 border border-blue-200 text-blue-700 hover:bg-blue-50 text-sm font-medium rounded-md dashboard">
                    <i data-lucide="download" class="w-4 h-4 mr-2"></i>
                    Export Report
                </button>
            </div>
        </div>
    </header>

    <!-- Analysis Progress -->
    <div id="progressBar" class="bg-blue-50 border-b border-blue-200 px-6 py-3 hidden">
        <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-medium text-blue-900">Running competitive intelligence analysis...</span>
            <span id="progressText" class="text-sm text-blue-700">0%</span>
        </div>
        <div class="w-full bg-blue-200 rounded-full h-2">
            <div id="progressFill" class="bg-blue-600 h-2 rounded-full progress-bar" style="width: 0%"></div>
        </div>
    </div>

    <!-- Setup Form -->
    <div id="setupForm" class="setup-form">
        <main class="px-6 py-12">
            <div class="max-w-2xl mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-stone-900 mb-4">Set Up Your Brand Analysis</h2>
                    <p class="text-lg text-stone-600">Enter your brand details to get started with competitive intelligence</p>
                </div>

                <div class="bg-white rounded-lg border border-stone-200 p-8">
                    <form id="brandForm" class="space-y-6">
                        <!-- Brand Information -->
                        <div>
                            <label for="brandName" class="block text-sm font-medium text-stone-700 mb-2">Your Brand Name</label>
                            <input type="text" id="brandName" name="brandName" required
                                class="w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="e.g., Supreme, Off-White, Your Brand">
                        </div>

                        <!-- Brand URL -->
                        <div>
                            <label for="brandUrl" class="block text-sm font-medium text-stone-700 mb-2">Brand Website (Optional)</label>
                            <input type="url" id="brandUrl" name="brandUrl"
                                class="w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="https://yourbrand.com">
                        </div>

                        <!-- Competitors -->
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Competitors (Add up to 5)</label>
                            <div id="competitorsList" class="space-y-2">
                                <input type="text" name="competitor" 
                                    class="w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Competitor 1 (e.g., Stüssy)">
                                <input type="text" name="competitor" 
                                    class="w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Competitor 2 (e.g., Supreme)">
                                <input type="text" name="competitor" 
                                    class="w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="Competitor 3 (Optional)">
                            </div>
                            <button type="button" id="addCompetitor" class="mt-2 text-sm text-blue-600 hover:text-blue-800">
                                + Add another competitor
                            </button>
                        </div>

                        <!-- Analysis Type -->
                        <div>
                            <label class="block text-sm font-medium text-stone-700 mb-2">Analysis Type</label>
                            <select id="analysisMode" name="analysisMode" 
                                class="w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="weekly_report">Weekly Report (Brand mentions, sentiment, trends)</option>
                                <option value="cultural_radar">Cultural Radar (Creator discovery)</option>
                                <option value="peer_tracker">Peer Tracker (Website competitive analysis)</option>
                                <option value="all">Complete Analysis (All features)</option>
                            </select>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" 
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-md transition-colors">
                            <i data-lucide="search" class="w-4 h-4 mr-2 inline"></i>
                            Start Analysis
                        </button>
                    </form>
                </div>

                <!-- Demo Button -->
                <div class="text-center mt-6">
                    <button id="loadDemo" class="text-sm text-stone-500 hover:text-stone-700 underline">
                        Or view demo with Crooks & Castles data
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <main class="px-6 py-6">
            <!-- Brand Header -->
            <div class="mb-8">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <h2 id="brandTitle" class="text-3xl font-bold text-stone-900">Your Brand</h2>
                        <p class="text-stone-600">Competitive Intelligence Dashboard</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-stone-500">Last updated</p>
                        <p class="text-sm font-medium text-stone-900">Just now</p>
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-lg border border-stone-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-stone-600">Brand Mentions</p>
                                <p id="brandMentions" class="text-2xl font-bold text-stone-900">847</p>
                            </div>
                            <div class="flex items-center text-green-600">
                                <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                                <span class="text-sm font-medium">35.9%</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg border border-stone-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-stone-600">Active Creators</p>
                                <p id="activeCreators" class="text-2xl font-bold text-stone-900">4</p>
                            </div>
                            <i data-lucide="users" class="w-8 h-8 text-stone-400"></i>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg border border-stone-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-stone-600">Avg Influence Score</p>
                                <p id="influenceScore" class="text-2xl font-bold text-stone-900">87</p>
                            </div>
                            <i data-lucide="star" class="w-8 h-8 text-amber-400"></i>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg border border-stone-200 p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-stone-600">Competitive Score</p>
                                <p id="competitiveScore" class="text-2xl font-bold text-stone-900">7.2/10</p>
                            </div>
                            <i data-lucide="target" class="w-8 h-8 text-stone-400"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="space-y-6">
                <div class="grid w-full grid-cols-4 bg-stone-100 rounded-lg p-1">
                    <button class="tab-button active px-4 py-2 text-sm font-medium rounded-md" data-tab="overview">Overview</button>
                    <button class="tab-button px-4 py-2 text-sm font-medium rounded-md" data-tab="cultural-radar">Cultural Radar</button>
                    <button class="tab-button px-4 py-2 text-sm font-medium rounded-md" data-tab="peer-tracker">Peer Tracker</button>
                    <button class="tab-button px-4 py-2 text-sm font-medium rounded-md" data-tab="insights">Insights</button>
                </div>

                <!-- Overview Tab -->
                <div id="overview" class="tab-content active space-y-6">
                    <!-- Customer Sentiment -->
                    <div class="bg-white rounded-lg border border-stone-200">
                        <div class="px-6 py-4 border-b border-stone-200">
                            <h3 class="text-lg font-semibold text-stone-900 flex items-center">
                                <div class="w-2 h-2 bg-red-400 rounded-full mr-2"></div>
                                Customer Sentiment
                            </h3>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                    <h4 class="font-semibold text-green-800 mb-2">Positive</h4>
                                    <p id="positiveSentiment" class="text-sm text-green-700">Loading sentiment analysis...</p>
                                </div>
                                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                    <h4 class="font-semibold text-red-800 mb-2">Negative</h4>
                                    <p id="negativeSentiment" class="text-sm text-red-700">Loading sentiment analysis...</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                    <h4 class="font-semibold text-gray-800 mb-2">Neutral</h4>
                                    <p id="neutralSentiment" class="text-sm text-gray-700">Loading sentiment analysis...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Streetwear Trends -->
                    <div class="bg-white rounded-lg border border-stone-200">
                        <div class="px-6 py-4 border-b border-stone-200">
                            <h3 class="text-lg font-semibold text-stone-900 flex items-center">
                                <div class="w-2 h-2 bg-blue-400 rounded-full mr-2"></div>
                                Industry Trends
                            </h3>
                        </div>
                        <div id="trendsContainer" class="p-6">
                            <p class="text-stone-500">Loading trend analysis...</p>
                        </div>
                    </div>
                </div>

                <!-- Cultural Radar Tab -->
                <div id="cultural-radar" class="tab-content space-y-6">
                    <div class="bg-white rounded-lg border border-stone-200">
                        <div class="px-6 py-4 border-b border-stone-200">
                            <h3 class="text-lg font-semibold text-stone-900">Top Creators to Activate</h3>
                            <p class="text-sm text-stone-600">High-influence creators under 100K followers with strong engagement rates</p>
                        </div>
                        <div id="creatorsContainer" class="p-6">
                            <p class="text-stone-500">Loading creator analysis...</p>
                        </div>
                    </div>
                </div>

                <!-- Peer Tracker Tab -->
                <div id="peer-tracker" class="tab-content space-y-6">
                    <div class="bg-white rounded-lg border border-stone-200">
                        <div class="px-6 py-4 border-b border-stone-200">
                            <h3 class="text-lg font-semibold text-stone-900">Competitive Scorecard</h3>
                            <p class="text-sm text-stone-600">DTC website performance across key dimensions (1-10 scale)</p>
                        </div>
                        <div id="scorecardContainer" class="p-6">
                            <p class="text-stone-500">Loading competitive analysis...</p>
                        </div>
                    </div>

                    <!-- Priority Action Items -->
                    <div class="bg-white rounded-lg border border-stone-200">
                        <div class="px-6 py-4 border-b border-stone-200">
                            <h3 class="text-lg font-semibold text-stone-900">Priority Action Items</h3>
                            <p class="text-sm text-stone-600">Ranked recommendations based on competitive analysis</p>
                        </div>
                        <div id="actionsContainer" class="p-6">
                            <p class="text-stone-500">Loading recommendations...</p>
                        </div>
                    </div>
                </div>

                <!-- Insights Tab -->
                <div id="insights" class="tab-content space-y-6">
                    <div class="bg-white rounded-lg border border-stone-200">
                        <div class="px-6 py-4 border-b border-stone-200">
                            <h3 class="text-lg font-semibold text-stone-900">Opportunities & Risks</h3>
                        </div>
                        <div id="insightsContainer" class="p-6">
                            <p class="text-stone-500">Loading insights...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global state
        let currentBrandData = null;

        // Tab functionality
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Remove active class from all tabs and buttons
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                button.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Form submission
        document.getElementById('brandForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const brandName = formData.get('brandName');
            const brandUrl = formData.get('brandUrl');
            const analysisMode = formData.get('analysisMode');
            
            // Get competitors
            const competitors = Array.from(formData.getAll('competitor'))
                .filter(comp => comp.trim() !== '')
                .map(comp => ({ name: comp.trim() }));
            
            // Prepare request data
            const requestData = {
                brand: {
                    name: brandName,
                    url: brandUrl || undefined
                },
                competitors: competitors,
                mode: analysisMode,
                window_days: 7
            };
            
            // Show dashboard and start analysis
            showDashboard(brandName);
            await runAnalysis(requestData);
        });

        // Demo button
        document.getElementById('loadDemo').addEventListener('click', function() {
            const demoData = {
                brand: { name: "Crooks & Castles" },
                competitors: [
                    { name: "Stüssy" },
                    { name: "Hellstar" },
                    { name: "Reason Clothing" },
                    { name: "Supreme" }
                ],
                mode: "all",
                window_days: 7
            };
            
            showDashboard("Crooks & Castles");
            runAnalysis(demoData);
        });

        // New analysis button
        document.getElementById('newAnalysis').addEventListener('click', function() {
            showSetupForm();
        });

        // Add competitor functionality
        document.getElementById('addCompetitor').addEventListener('click', function() {
            const competitorsList = document.getElementById('competitorsList');
            const competitorInputs = competitorsList.querySelectorAll('input');
            
            if (competitorInputs.length < 5) {
                const newInput = document.createElement('input');
                newInput.type = 'text';
                newInput.name = 'competitor';
                newInput.className = 'w-full px-3 py-2 border border-stone-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500';
                newInput.placeholder = `Competitor ${competitorInputs.length + 1} (Optional)`;
                competitorsList.appendChild(newInput);
                
                if (competitorInputs.length >= 4) {
                    this.style.display = 'none';
                }
            }
        });

        // Show/hide functions
        function showSetupForm() {
            document.getElementById('setupForm').classList.remove('hidden');
            document.getElementById('dashboard').classList.remove('active');
            document.querySelectorAll('.dashboard').forEach(el => el.style.display = 'none');
        }

        function showDashboard(brandName) {
            document.getElementById('setupForm').classList.add('hidden');
            document.getElementById('dashboard').classList.add('active');
            document.querySelectorAll('.dashboard').forEach(el => el.style.display = 'inline-flex');
            document.getElementById('brandTitle').textContent = brandName;
        }

        // Analysis functionality
        async function runAnalysis(requestData) {
            try {
                // Show progress
                const progressBar = document.getElementById('progressBar');
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                
                progressBar.classList.remove('hidden');
                
                // Simulate progress
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 90) progress = 90;
                    
                    progressFill.style.width = progress + '%';
                    progressText.textContent = Math.round(progress) + '%';
                }, 500);

                // Make API call
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();
                currentBrandData = data;

                // Complete progress
                clearInterval(progressInterval);
                progressFill.style.width = '100%';
                progressText.textContent = '100%';
                
                setTimeout(() => {
                    progressBar.classList.add('hidden');
                    updateDashboard(data, requestData.brand.name);
                }, 1000);

            } catch (error) {
                console.error('Analysis failed:', error);
                // Hide progress and show error
                document.getElementById('progressBar').classList.add('hidden');
                alert('Analysis failed. Please try again.');
            }
        }

        // Update dashboard with data
        function updateDashboard(data, brandName) {
            // Update metrics
            if (data.weekly_report?.brand_mentions_overview) {
                document.getElementById('brandMentions').textContent = data.weekly_report.brand_mentions_overview.this_window || 'N/A';
            }

            // Update sentiment
            if (data.weekly_report?.customer_sentiment) {
                document.getElementById('positiveSentiment').textContent = data.weekly_report.customer_sentiment.positive || 'No positive sentiment data available';
                document.getElementById('negativeSentiment').textContent = data.weekly_report.customer_sentiment.negative || 'No negative sentiment data available';
                document.getElementById('neutralSentiment').textContent = data.weekly_report.customer_sentiment.neutral || 'No neutral sentiment data available';
            }

            // Update trends
            if (data.weekly_report?.streetwear_trends) {
                const trendsContainer = document.getElementById('trendsContainer');
                trendsContainer.innerHTML = '';
                
                data.weekly_report.streetwear_trends.forEach(trend => {
                    const trendDiv = document.createElement('div');
                    trendDiv.className = 'border-l-4 border-blue-200 pl-4 mb-6';
                    trendDiv.innerHTML = `
                        <h4 class="font-semibold text-stone-900 mb-2">${trend.trend}</h4>
                        <p class="text-sm text-stone-600 mb-3">${trend.description}</p>
                        <div class="flex flex-wrap gap-2">
                            ${trend.hashtags.map(tag => `<span class="px-2 py-1 bg-stone-100 text-stone-700 text-xs rounded">${tag}</span>`).join('')}
                        </div>
                    `;
                    trendsContainer.appendChild(trendDiv);
                });
            }

            // Update creators
            if (data.cultural_radar?.creators) {
                const creatorsContainer = document.getElementById('creatorsContainer');
                creatorsContainer.innerHTML = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>';
                const grid = creatorsContainer.querySelector('.grid');
                
                data.cultural_radar.creators.forEach(creator => {
                    const creatorDiv = document.createElement('div');
                    creatorDiv.className = 'border border-stone-200 rounded-lg p-4 hover:shadow-md transition-shadow';
                    creatorDiv.innerHTML = `
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <h4 class="font-semibold text-stone-900">${creator.handle}</h4>
                                <p class="text-sm text-stone-500">${creator.platform}</p>
                            </div>
                            <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded">${creator.recommendation}</span>
                        </div>
                        <div class="space-y-2 mb-4">
                            <div class="flex justify-between text-sm">
                                <span class="text-stone-600">Followers</span>
                                <span class="font-medium">${(creator.followers / 1000).toFixed(1)}K</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-stone-600">Engagement Rate</span>
                                <span class="font-medium">${creator.engagement_rate}%</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-stone-600">Influence Score</span>
                                <span class="font-medium">${creator.influence_score}/100</span>
                            </div>
                        </div>
                        <p class="text-xs text-stone-500 mb-3">${creator.content_focus}</p>
                        <button class="w-full px-3 py-1 border border-stone-300 text-stone-700 text-sm rounded hover:bg-stone-50">View Profile</button>
                    `;
                    grid.appendChild(creatorDiv);
                });
            }

            // Update competitive scorecard
            if (data.peer_tracker?.scorecard) {
                const scorecardContainer = document.getElementById('scorecardContainer');
                const scorecard = data.peer_tracker.scorecard;
                
                let tableHTML = `
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-stone-200">
                                    <th class="text-left py-3 px-4 font-medium text-stone-600">Dimension</th>
                `;
                
                scorecard.brands.forEach(brand => {
                    tableHTML += `<th class="text-center py-3 px-4 font-medium text-stone-600">${brand}</th>`;
                });
                
                tableHTML += `
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                scorecard.dimensions.forEach((dimension, dimIndex) => {
                    tableHTML += `
                        <tr class="border-b border-stone-100">
                            <td class="py-3 px-4 font-medium text-stone-900">${dimension}</td>
                    `;
                    
                    scorecard.scores.forEach(brandScore => {
                        const score = brandScore.scores[dimIndex];
                        const colorClass = score >= 8 ? 'bg-green-100 text-green-800' : 
                                         score >= 6 ? 'bg-yellow-100 text-yellow-800' : 
                                         score >= 4 ? 'bg-orange-100 text-orange-800' : 'bg-red-100 text-red-800';
                        tableHTML += `<td class="text-center py-3 px-4"><span class="px-2 py-1 ${colorClass} text-xs rounded">${score}</span></td>`;
                    });
                    
                    tableHTML += `</tr>`;
                });
                
                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                scorecardContainer.innerHTML = tableHTML;
            }

            // Update action items
            if (data.peer_tracker?.priority_fixes) {
                const actionsContainer = document.getElementById('actionsContainer');
                actionsContainer.innerHTML = '<div class="space-y-4"></div>';
                const actionsDiv = actionsContainer.querySelector('.space-y-4');
                
                data.peer_tracker.priority_fixes.forEach(fix => {
                    const actionDiv = document.createElement('div');
                    actionDiv.className = 'border border-stone-200 rounded-lg p-4';
                    const impactColor = fix.impact === 'high' ? 'bg-red-100 text-red-800' : 
                                      fix.impact === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
                    actionDiv.innerHTML = `
                        <div class="flex items-start justify-between mb-2">
                            <h4 class="font-medium text-stone-900 flex-1">${fix.action}</h4>
                            <span class="px-2 py-1 ${impactColor} text-xs rounded">${fix.impact} impact</span>
                        </div>
                        <p class="text-sm text-stone-600">${fix.description}</p>
                    `;
                    actionsDiv.appendChild(actionDiv);
                });
            }

            // Update insights
            if (data.weekly_report?.opportunities_risks) {
                const insightsContainer = document.getElementById('insightsContainer');
                insightsContainer.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-green-50 p-6 rounded-lg border border-green-200">
                            <h4 class="font-semibold text-green-800 mb-4">Opportunities</h4>
                            <ul class="space-y-2 text-sm text-green-700">
                                <li>• Strong brand positioning in target market</li>
                                <li>• Growing engagement with target audience</li>
                                <li>• Opportunity for creator partnerships</li>
                                <li>• Positive sentiment around brand quality</li>
                            </ul>
                        </div>
                        <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                            <h4 class="font-semibold text-red-800 mb-4">Risks</h4>
                            <ul class="space-y-2 text-sm text-red-700">
                                <li>• Competitive pressure in pricing</li>
                                <li>• Need for improved digital experience</li>
                                <li>• Limited creator activation vs competitors</li>
                                <li>• Customer service optimization needed</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }

        // Run analysis button
        document.getElementById('runAnalysis').addEventListener('click', function() {
            if (currentBrandData) {
                // Re-run analysis with current brand data
                const requestData = {
                    brand: { name: document.getElementById('brandTitle').textContent },
                    competitors: [{ name: "Competitor 1" }, { name: "Competitor 2" }],
                    mode: "all",
                    window_days: 7
                };
                runAnalysis(requestData);
            }
        });

        // Initialize icons after DOM updates
        function refreshIcons() {
            lucide.createIcons();
        }

        // Call refreshIcons after any DOM updates
        setInterval(refreshIcons, 1000);
    </script>
</body>
</html>

